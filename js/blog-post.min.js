/*!
 * Start Bootstrap - Clean Blog v5.0.1 (https://startbootstrap.com/template-overviews/clean-blog)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-clean-blog/blob/master/LICENSE)
 */

var numPage,keyword,mode,error,fs=require("fs"),path=require("path"),blogPerPage=3,currPage=1,month=new Map([["01","Januray"],["02","Feburary"],["03","March"],["04","April"],["05","May"],["06","June"],["07","July"],["08","August"],["09","September"],["10","October"],["11","November"],["12","December"]]),MODE={INDEX:0,TAG:1,SEARCH:2},blogs=[];function init_page(){var e=window.location.search;mode=e.includes("tag")?(console.log("tag mode"),keyword=e.substring(e.indexOf("=")+1,e.length),MODE.TAG):e.includes("keyword")?(console.log("search mode"),keyword=e.substring(e.indexOf("=")+1,e.length),MODE.SEARCH):(console.log(mode),MODE.INDEX),keyword=keyword&&keyword.replace("%20"," "),console.log("tag is "+keyword),error=!0;var o=search_blog();o=o.reverse(),0<(numPage=Math.ceil(o.length/blogPerPage))&&mode==MODE.INDEX&&setup_pagination(),setup_page()}function search_blog(){var e=fs.readdirSync("./posts/");for(var o in e)""===path.extname(e[o])&&(blogs.push(e[o]+"/post.html"),console.log(e[o]+"/post.html"));return blogs}function setup_page(){var e,o=(currPage-1)*blogPerPage;if(o<0||o>=blogs.length)console.log("error!");else for(mode==MODE.INDEX?(e=Math.min(o+blogPerPage,blogs.length),console.log("index")):e=blogs.length,i=o;i<e;i++)document.getElementById("card-list-placeholder").innerHTML+='<div class="card mb-4" id="post_'+i.toString()+'"></div>',parse_html("./posts/"+blogs[i],i)}function setup_pagination(){for($("#paginator").html('<div id="paginator-placeholder"></div>'),1==currPage?$("#paginator-placeholder").before('<li class="page-item disabled" id="newer_button"><a class="page-link" href="javascript:on_newer_blog()">&larr; Newer</a></li>'):$("#paginator-placeholder").before('<li class="page-item" id="newer_button"><a class="page-link" href="javascript:on_newer_blog()">&larr; Newer</a></li>'),i=1;i<=numPage;i++)currPage==i?$("#paginator-placeholder").before('<li class="page-item active"><a class="page-link" href="javascript:on_page_number('+i+')">'+i+"</a></li>"):$("#paginator-placeholder").before('<li class="page-item"><a class="page-link" href="javascript:on_page_number('+i+')">'+i+"</a></li>");currPage==numPage?$("#paginator-placeholder").before('<li class="page-item disabled" id="older_button"><a class="page-link" href="javascript:on_older_blog()">Older &rarr;</a></li>'):$("#paginator-placeholder").before('<li class="page-item" id="older_button"><a class="page-link" href="javascript:on_older_blog()">Older &rarr;</a></li>')}function parse_html(e,o){var a=new XMLHttpRequest;a.addEventListener("load",function(){load_card(a.response,e,o)},!1),a.open("GET",e),a.send()}function load_card(e,o,a){if(parser=new DOMParser,htmlDoc=parser.parseFromString(e,"text/html"),card=document.getElementById("post_"+a.toString()),mode==MODE.INDEX||check_tag(mode,keyword)||check_search(mode,keyword)){var r=o.replace("post.html","cover.jpg"),t=o.slice(8,18);t=t.split("_"),card.innerHTML+='<img class="card-img-top" src="'+r+'" alt="Card image cap"/>',card.innerHTML+='<div class="card-body"><h2 class="card-title" align-items-center>'+htmlDoc.getElementById("title").childNodes[0].nodeValue+"</h2>",card.innerHTML+='<a href="'+o+'" class="btn btn-primary">Read More &rarr;</a></div>';var n="'"+htmlDoc.getElementById("tag").childNodes[0].innerText+"'";card.innerHTML+='<div class="card-footer text-muted">Posted on '+month.get(t[1])+" "+t[2]+", "+t[0]+'  <kbd id="tag"><a href="javascript:on_tag('+n+')">'+htmlDoc.getElementById("tag").childNodes[0].innerText+"</a></kbd>",$(".card-img-top").on("error",function(){$(this).attr("src","./posts/default.jpg")})}else card.parentNode.removeChild(card)}function check_tag(e,o){return e==MODE.TAG&&htmlDoc.getElementById("tag").childNodes[0].innerText==o}function check_search(e,o){return e==MODE.SEARCH&&htmlDoc.body.textContent.match(RegExp(o,"gi"))}function dummy(){console.log("dummy")}$(function(){init_page()}),window.on_older_blog=function(){numPage<++currPage&&(currPage=numPage,document.getElementById("older_button").disabled=!0),document.getElementById("blog-title").scrollIntoView(!0),document.getElementById("card-list-placeholder").innerHTML="",setup_page(),setup_pagination()},window.on_newer_blog=function(){1<--currPage&&(currPage=numPage),document.getElementById("blog-title").scrollIntoView(!0),document.getElementById("card-list-placeholder").innerHTML="",setup_page(),setup_pagination()},window.on_page_number=function(e){currPage=e,document.getElementById("blog-title").scrollIntoView(!0),document.getElementById("card-list-placeholder").innerHTML="",setup_page(),setup_pagination()},window.on_tag=function(e){window.location.href="./index.html?tag="+e},window.on_tag_post=function(e){window.location.href="../../index.html?tag="+e},window.on_search=function(e){window.location.href="./index.html?keyword="+e},window.on_keyup=function(e){13==e.keyCode&&document.getElementsByName("search-btn")[0].click()};